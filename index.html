<!DOCTYPE html>
<head>
    <style type="text/css">
        #container canvas {
            border: 1px solid rebeccapurple;
        }
    </style>
    <script type="text/javascript">
        class Maze {
            constructor(rows, cols, wallProbability) {
                this.rows = rows;
                this.cols = cols;
                this.wallProbability = wallProbability
                this.dotColor = "red";
                this.wallColor = "green";
                this.radius = 3;
                this.boxSize = 30;

                this.#createCanvas();
                this.#drawDot();
                this.#wallWorker();
                this.#generateWall();
            }

            #generateWall(){
                for(var i = this.boxSize+1; i < this.canvas.height; i+=this.boxSize+1){
                    for(var j = this.boxSize+1; j < this.canvas.width; j+=this.boxSize+1){

                        let hMessage = { x: j, y: i -(this.boxSize+1), wp: this.wallProbability }
                        this.horizontallWallWorker.postMessage(hMessage)
                        let vMessage = { x: j-(this.boxSize+1), y: i, wp: this.wallProbability }
                        this.verticalWallWorker.postMessage(vMessage)
                    }
                }


                
            }

            #wallWorker(){
                if (typeof(Worker) !== "undefined") {
                    if (typeof(worker) == "undefined") {
                        let that = this
                        this.horizontallWallWorker = new Worker("maze_worker.js")
                        this.verticalWallWorker = new Worker("maze_worker.js")

                        this.horizontallWallWorker.onmessage = function(result){
                            that.#drawHorizontalWall(result.data)
                        };

                        this.verticalWallWorker.onmessage = function(result){
                            that.#drawVerticalWall(result.data)
                        };
                    }
                }
            }

            #createCanvas(){
                const container = document.getElementById('container');
                this.canvas = document.createElement('canvas');
                this.canvas.width = this.cols * this.boxSize + this.cols;
                this.canvas.height = this.rows * this.boxSize + this.rows;

                this.context = this.canvas.getContext("2d");
                container.append(this.canvas)
            }

            #drawDot() {
                this.context.fillStyle = this.dotColor;
                for(let i = this.boxSize/2; i < this.canvas.height; i+=this.boxSize+1){
                    for(let j = this.boxSize/2; j < this.canvas.width; j+=this.boxSize+1){
                        this.context.fillRect(i, j, this.radius, this.radius);
                    }
                }
            }

            #drawHorizontalWall(result) {
                if(result.wall){
                    this.context.beginPath();
                    this.context.moveTo(result.x, result.y);
                    this.context.lineTo(result.x, result.y+this.boxSize);
                    this.context.stroke();
                    this.context.strokeStyle = this.wallColor;
                    this.context.lineWidth = 1; 
                }
            }

            #drawVerticalWall(result) {
                if(result.wall){
                    this.context.beginPath();
                    this.context.moveTo(result.x, result.y);
                    this.context.lineTo(result.x+this.boxSize, result.y);
                    this.context.stroke();
                    this.context.strokeStyle = this.wallColor;
                    this.context.lineWidth = 1; 
                }
            }

            generate() {
                const maze = [];
                for (let r = 0; r < this.rows; r++) {
                    const row = [];
                    for (let c = 0; c < this.cols; c++) {
                        if (Math.random() < this.wallProbability) {
                            //row.push(' | '); // Wall
                        } else {
                            //row.push(' . '); // Path
                        }
                    }
                    maze.push(row);
                }
                return maze;
            }
        }
    </script>
</head>
<body>
    <div id="container">

    </div>
    <script type="text/javascript">
        var maze = new Maze(16, 16, 0.68)
    </script>
</body>
</html>
